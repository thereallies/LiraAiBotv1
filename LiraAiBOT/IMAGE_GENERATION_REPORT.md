# –û—Ç—á–µ—Ç: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ LiraAI Bot

**–î–∞—Ç–∞:** 2026-03-01  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–†–∞–±–æ—á–∞—è –º–æ–¥–µ–ª—å:** Stable Diffusion 3 Medium

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ](#–∏–∑–º–µ–Ω–µ–Ω–∏—è-–≤-–∫–æ–¥–µ)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
4. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
5. [–†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#—Ä–µ—à–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
6. [–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#—Ç–µ–∫—É—â–∞—è-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

---

## –û–±–∑–æ—Ä

### –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ Telegram –±–æ—Ç–∞ LiraAI —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Hugging Face Inference API.

### –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ **Stable Diffusion 3 Medium** - —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ HF Inference API
- ‚ö†Ô∏è **Gemini Image** - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –†–§)

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. `backend/vision/hf_replicate.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Hugging Face Inference API

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ `.env` —á–µ—Ä–µ–∑ `load_dotenv()`
- –ú–æ–¥–µ–ª—å: `stabilityai/stable-diffusion-3-medium-diffusers`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —É—Ä–æ–≤–Ω–µ–π –¥–æ—Å—Ç—É–ø–∞ (admin/subscriber/user)
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PIL.Image –≤ bytes

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
from backend.vision.hf_replicate import get_hf_replicate_client

client = get_hf_replicate_client()
image_data = await client.generate_image(
    prompt="–∫–æ—Ç–∏–∫",
    model_key="hf-sd3-medium",
    timeout=60
)
```

### 2. `backend/api/telegram_polling.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò–º–ø–æ—Ä—Ç `hf_replicate_client`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_image_generation()`:
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–æ–¥–µ–ª–∏ (`is_hf_model`)
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ HF API
  - Gemini –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–µ–∂–∏–º `generation` - —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –£–¥–∞–ª–µ–Ω –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞ —á–µ—Ä–µ–∑ LLM (–∑–∞–≤–∏—Å–∞–ª)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç
    ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (–ë–î)
    ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è "–ì–µ–Ω–µ—Ä–∏—Ä—É—é..."
    ‚Üì
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ HF API
    ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

### 3. `backend/utils/keyboards.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
models_by_level = {
    "admin": [
        # [{"text": "‚ú® Gemini 2.5 Flash", ...}],  # –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
        [{"text": "üé® Stable Diffusion 3", "callback_data": "img_hf-sd3-medium"}],
    ],
    # ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è subscriber –∏ user
}
```

### 4. `backend/api/callback_handler.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ callback-–∫–Ω–æ–ø–æ–∫

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –û–±–Ω–æ–≤–ª–µ–Ω–æ welcome-—Å–æ–æ–±—â–µ–Ω–∏–µ
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Gemini Image - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### 5. `backend/main.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ü–µ—Ä–µ–º–µ—â–µ–Ω –∏–º–ø–æ—Ä—Ç `telegram_polling` **–ø–æ—Å–ª–µ** –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ logging
- –¢–µ–ø–µ—Ä—å –ª–æ–≥–∏ `hf_replicate` –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ñ–∞–π–ª

### 6. `.env`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```bash
# Hugging Face (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
HF_TOKEN=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
HUGGINGFACE_API_KEY=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
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|------------|----------|-------------|
| `HF_TOKEN` | –¢–æ–∫–µ–Ω Hugging Face | ‚úÖ –î–∞ |
| `HUGGINGFACE_API_KEY` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è | ‚úÖ –î–∞ |
| `GEMINI_API_KEY` | –î–ª—è Gemini (–±—É–¥—É—â–µ–µ) | ‚ùå –ù–µ—Ç |

### –ü–æ–ª—É—á–µ–Ω–∏–µ HF —Ç–æ–∫–µ–Ω–∞

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://huggingface.co/settings/tokens
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ **read**
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ `.env`

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞

```bash
cd /Users/iluyshin.d/Desktop/LiraAiBOT
python3 -c "
from backend.vision.hf_replicate import get_hf_replicate_client
client = get_hf_replicate_client()
print('API Key:', '‚úÖ' if client.api_key else '‚ùå')
print('Client:', '‚úÖ' if client.client else '‚ùå')
print('Models:', list(client.models.keys()))
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
API Key: ‚úÖ
Client: ‚úÖ
Models: ['hf-sd3-medium']
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Telegram

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start`
2. –í—ã–±—Ä–∞—Ç—å "üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è"
3. –í—ã–±—Ä–∞—Ç—å "üé® Stable Diffusion 3"
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ: `–∫–æ—Ç–∏–∫`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–æ–±—â–µ–Ω–∏–µ "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ..."
- –ß–µ—Ä–µ–∑ 10-30 —Å–µ–∫—É–Ω–¥: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

---

## –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. HF –∫–ª–∏–µ–Ω—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `.env` –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª—Å—è –¥–æ –∏–º–ø–æ—Ä—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ `load_dotenv()` –≤ `hf_replicate.py`

### 2. –õ–æ–≥–∏ –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ —Ñ–∞–π–ª

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–º–ø–æ—Ä—Ç `telegram_polling` –¥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ logging

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—â–µ–Ω –∏–º–ø–æ—Ä—Ç –ø–æ—Å–ª–µ `logging.basicConfig()`

### 3. –ë–æ—Ç –∑–∞–≤–∏—Å–∞–ª –ø–æ—Å–ª–µ "–ì–µ–Ω–µ—Ä–∏—Ä—É—é..."

**–ü—Ä–æ–±–ª–µ–º–∞ 1:** –†–µ–∂–∏–º `generation` –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Ç–µ–∫—Å—Ç

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if text:` –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∂–∏–º–∞

**–ü—Ä–æ–±–ª–µ–º–∞ 2:** –ü–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞ —á–µ—Ä–µ–∑ LLM –∑–∞–≤–∏—Å–∞–ª

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω –ø–µ—Ä–µ–≤–æ–¥, HF API –ø–æ–Ω–∏–º–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π

### 4. FLUX.1 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** 402 Payment Required –¥–ª—è FLUX.1 —á–µ—Ä–µ–∑ HF

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω—ã –Ω–∞ Stable Diffusion 3 Medium (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

### 5. Gemini –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –†–§

**–ü—Ä–æ–±–ª–µ–º–∞:** 400 FAILED_PRECONDITION - Image generation is not available in your country

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –¥–æ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã (VPN/proxy)

---

## –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –†–∞–±–æ—á–∏–µ –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –°—Ç–∞—Ç—É—Å | –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞ |
|--------|-----------|--------|-----------------|
| Stable Diffusion 3 | Hugging Face | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –í—Å–µ —É—Ä–æ–≤–Ω–∏ |
| Gemini 2.5 Flash | Google | ‚ö†Ô∏è –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ | - |

### –£—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞

| –£—Ä–æ–≤–µ–Ω—å | –ì–µ–Ω–µ—Ä–∞—Ü–∏–π/–¥–µ–Ω—å | –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ |
|---------|----------------|------------------|
| user | 3 | Stable Diffusion 3 |
| subscriber | 5 | Stable Diffusion 3 |
| admin | ‚àû | Stable Diffusion 3 |

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `logs/bot.log`

**–ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏:**
```
‚úÖ HF –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω (Stable Diffusion 3)
üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è XXX: –∫–æ—Ç–∏–∫
üîç –û—Ç–ª–∞–¥–∫–∞: model_key=hf-sd3-medium, is_hf_model=True
üé® HF –∑–∞–ø—Ä–æ—Å (hf-sd3-medium): kitten, high quality...
‚úÖ HF —É—Å–ø–µ—à–Ω–æ: XXXXX –±–∞–π—Ç
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
backend/
‚îú‚îÄ‚îÄ vision/
‚îÇ   ‚îú‚îÄ‚îÄ hf_replicate.py      # HF API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ gemini_image.py      # Gemini –∫–ª–∏–µ–Ω—Ç (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ telegram_polling.py  # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ callback_handler.py  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ keyboards.py         # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
```

---

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Gemini Image (—Ç—Ä–µ–±—É–µ—Ç—Å—è VPN/proxy)
- [ ] –î–æ–±–∞–≤–∏—Ç—å KIE.AI (Nano Banana 2)
- [ ] –î–æ–±–∞–≤–∏—Ç—å Replicate API (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- [ ] –ü–∞–∫–µ—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- [ ] –°—Ç–∏–ª–µ–≤—ã–µ –ø—Ä–µ—Å–µ—Ç—ã

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** Danil Alekseevich  
**–ö–∞–Ω–∞–ª:** @liranexus  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-03-01
